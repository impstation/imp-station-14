# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

- type: entity
  parent: BaseItem
  id: IVBag
  name: iv bag
  description: Used to hold blood or other fluids to administer intravenously to a patient.
  components:
  - type: SolutionContainerManager
    solutions:
      beaker:
        maxVol: 400
  - type: Sprite
    sprite: _Offbrand/iv_bag.rsi
    layers:
    - state: base
    - state: fill-1
      map: [ "enum.SolutionContainerLayers.Fill" ]
      visible: false
    - state: label
  - type: Item
    size: Large
  - type: RefillableSolution
    solution: beaker
  - type: ExaminableSolution
    solution: beaker
    exactVolume: true
  - type: DrawableSolution
    solution: beaker
  - type: InjectableSolution
    solution: beaker
  - type: SolutionItemStatus
    solution: beaker
  - type: Appearance
  - type: SolutionContainerVisuals
    maxFillLevels: 4
    fillBaseName: fill-
  - type: StaticPrice
    price: 60
  - type: Damageable
    damageContainer: Inorganic
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
        - !type:DoActsBehavior
          acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 20
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
          params:
            volume: -4
      - !type:SpillBehavior { }
      - !type:SpawnEntitiesBehavior
        spawn:
          SheetPlastic1:
            min: 0
            max: 1
        transferForensics: true
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: Label
  - type: DnaSubstanceTrace
  - type: Tag
    tags:
    - IVBag
  - type: SolutionAppearanceRelay
    solution: beaker
    whitelist:
      tags:
      - IVStand

- type: entity
  id: IVStand
  name: iv stand
  description: Holds IV bags and allows their contents to be administered intravenously to patients.
  components:
  - type: Animateable
  - type: Clickable
  - type: InteractionOutline
  - type: Physics
    bodyType: Dynamic
  - type: MovedByPressure
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeCircle
          radius: 0.1
        density: 4000
        restitution: 0.0
        mask:
        - MachineMask
        layer:
        - MidImpassable
        - LowImpassable
        - BulletImpassable
  - type: Sprite
    sprite: _Offbrand/iv_stand.rsi
    layers:
    - state: base
    - state: bag
      map: ["bag"]
      visible: false
    - state: fill-1
      map: [ "enum.SolutionContainerLayers.Fill" ]
      visible: false
    drawdepth: Mobs
    noRot: true
  - type: Pullable
  - type: Damageable
    damageContainer: Inorganic
    damageModifierSet: Metallic
  - type: Anchorable
  - type: Rotatable
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 100
      behaviors:
        - !type:DoActsBehavior
          acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 50
      behaviors:
      - !type:DoActsBehavior
        acts: ["Destruction"]
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
  - type: ItemSlots
    slots:
      iv_bag_slot:
        whitelist:
          tags:
          - IVBag
  - type: ContainerContainer
    containers:
      iv_bag_slot: !type:ContainerSlot
  - type: Appearance
  - type: GenericVisualizer
    visuals:
      enum.SolutionAppearanceRelayedVisuals.HasRelay:
        enum.SolutionContainerLayers.Fill:
          True: { visible: true }
          False: { visible: false }
        bag:
          True: { visible: true }
          False: { visible: false }
  - type: SolutionContainerVisuals
    maxFillLevels: 4
    fillBaseName: fill-
  - type: Tag
    tags:
    - IVStand
